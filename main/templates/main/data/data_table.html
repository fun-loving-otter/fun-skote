{% extends 'partials/base.html' %}

{% load static %}

{% block sidebar %}
<!-- ========== Left Sidebar Start ========== -->
<div class="vertical-menu">
  <div data-simplebar class="h-100">
    <!--- Sidemenu -->
    <div id="sidebar-menu">
      <!--- Tabs -->
      <ul class="nav nav-tabs">
        <li class="nav-item">
          <a class="nav-link active" id="menu-tab" data-bs-toggle="tab" href="#menu">Menu</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="filter-tab" data-bs-toggle="tab" href="#filter">Filter</a>
        </li>
      </ul>
      <!--- Tab content -->
      <div class="tab-content">
        <!--- Original menu -->
        <div class="tab-pane fade show active" id="menu" role="tabpanel" aria-labelledby="menu-tab">
          <!-- Left Menu Start -->
          <ul class="metismenu list-unstyled" id="side-menu">
            {% if user.is_authenticated %}
            <li>
              <a href="{% url 'main:data-list' %}">
                <i class="fas fa-table"></i>
                <span>Just Funded</span>
              </a>
            </li>
            <li>
              <a href="{% url 'main:datalist-list' %}">
                <i class="fas fa-list-alt"></i>
                <span>Lists</span>
              </a>
            </li>
            {% endif %}
          </ul>
        </div>
        <!--- Filters -->
        <div class="tab-pane fade" id="filter" role="tabpanel" aria-labelledby="filter-tab">
          <div class="pb-4">
            {% block filters %}
            {% include 'main/data/filters.html' %}
            {% endblock %}
          </div>
        </div>
      </div>
    </div>
    <!-- Sidebar -->
  </div>
</div>
{% endblock %}

{% block extra_css %}
{% include 'partials/css_datatables.html' %}
{% include 'partials/css_toastr.html' %}
{% include 'partials/css_sweet_alert.html' %}

<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/select/1.6.2/css/select.bootstrap5.min.css">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/datetime/1.4.1/css/dataTables.dateTime.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" />
<style>
  button.yadcf-filter-reset-button {
    display: none;
  }
</style>
{% endblock %}


{% block content %}
<div class="card">
  <div class="card-header">
    <h5 class="card-title">JUST FUNDED</h5>
  </div>

  <div class="card-body">
    <div class="mb-3">
      <div class="dropdown">
        <button class="btn btn-primary dropdown-toggle" type="button" id="add-to-list" data-bs-toggle="dropdown" aria-expanded="false">
          Add to List
        </button>
        <ul class="dropdown-menu" aria-labelledby="add-to-list">
          {% for datalist in datalists %}
          <li><button class="dropdown-item" onclick="AddSelectedToList('{% url 'main:api-datalist-update' pk=datalist.pk %}')">{{ datalist.name }}</button></li>
          {% endfor %}
        </ul>
      </div>
    </div>

    <div class="mb-3">
      Show Funded in Last:
      <div class="btn-group" role="group" aria-label="Funding Period">
          <button type="button" class="btn btn-outline-primary" id="fundingPeriod7">7 days</button>
          <button type="button" class="btn btn-outline-primary" id="fundingPeriod14">14 days</button>
          <button type="button" class="btn btn-outline-primary" id="fundingPeriod30">30 days</button>
      </div>
    </div>

    <div class="table-responsive">
      <table id="data-table" class="table table-striped align-middle display text-nowrap" data-tabletype="dataTableServer">
        <thead>
          <tr>
            <th></th>
            {% for field in model_fields %}
              <th id="{{field.name}}_column">{{ field.verbose_name }}</th>
            {% endfor %}
          </tr>
        </thead>

        <tbody class="align-top">
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}


{% block extra_javascript %}
{% include 'partials/js_datatables.html' %}
{% include 'partials/js_toastr.html' %}
{% include 'partials/js_sweet_alert.html' %}
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script src="https://cdn.datatables.net/datetime/1.4.1/js/dataTables.dateTime.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.2/moment.min.js"></script>

<script src="{% static 'libs/select2/js/select2.min.js' %}"></script>

{{ select_options|json_script:"select_options" }}

<script>
const ADD_TO_LIST_BUTTON_TEMPLATE = `
<div class="dropdown">
  <button class="btn btn-primary dropdown-toggle" type="button" id="add-to-list" data-bs-toggle="dropdown" aria-expanded="false">
    Add to List To Reveal
  </button>
  <ul class="dropdown-menu" aria-labelledby="add-to-list">
    {% for datalist in datalists %}
    <li><button class="dropdown-item" onclick="AddToList('{% url 'main:api-datalist-update' pk=datalist.pk %}', [{data-id}])">{{ datalist.name }}</button></li>
    {% endfor %}
  </ul>
</div>
`

const TABLE_API_URL = "{% url 'main:api-data-list' %}?format=datatables";
const SELECT_OPTIONS = JSON.parse($('#select_options').html());

function renderFunction(data, type, row) {
  if (data == "*hidden*") {
    return ADD_TO_LIST_BUTTON_TEMPLATE.replace('{data-id}', row.id);
  } else {
    return data;
  }
}

const TABLE_COLUMNS = [
    { data: "" },
    {% for field in model_fields %}
      {% if field.name in hidden_fields %}
      {
        data: "{{ field.name }}",
        render: renderFunction
      },
      {% else %}
      { data: "{{ field.name }}" },
      {% endif %}
    {% endfor %}
];
</script>
<script src="{% static 'js/main/data/data_table.js' %}"></script>
{% endblock %}
