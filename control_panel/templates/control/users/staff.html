{% extends 'control/partials/base.html' %}
{% load static %}

{% block extra_css %}
{% include 'partials/css_toastr.html' %}
{% include 'partials/css_datatables.html' %}
{% endblock %}

{% block modals %}
{% for user in users %}
{% include 'control/users/admin-permissions-modal.html' with form=user.form %}
{% endfor %}
{% include 'control/users/user-creation-modal.html' %}
{% endblock %}

{% block content %}
<div class="card">
	<div class="card-body">
		<h5 class="card-title">Actions</h5>
		<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#create-user-modal">
			Create Admin
		</button>
	</div>
</div>

<div class="card">
	<div class="card-body">
		<h5 class="card-title">Administrators</h5>
		
		<table class="table align-middle" data-tabletype="dataTable">
			<thead>
				<th>First Name</th>
				<th>Last Name</th>
				<th>Email</th>
				<th style="width: 5%;">Active (verified email)</th>
				<th style="width: 5%;">Is Staff</th>
				<th style="width: 5%;">Is Superuser</th>
				<th style="width: 5%;">Edit Permissions</th>
				<th style="width: 5%;">Delete</th>
			</thead>
			<tbody>
				{% for user in users %}
				<tr data-user="{{user.pk}}">
					<td>{{user.first_name}}</td>
					<td>{{user.last_name}}</td>
					<td>{{user.email}}</td>
					<td>
						<button class="btn p-0 m-0" onclick="togglePermission({{user.pk}}, 'active')">
							<i class="bx bxs-check-square text-success fs-1{% if not user.is_active %} collapse{% endif %}" data-user="{{user.pk}}" data-active="true"></i>
							<i class="bx bxs-x-square text-danger fs-1{% if user.is_active %} collapse{% endif %}" data-user="{{user.pk}}" data-active="false"></i>
						</button>
					</td>
					<td>
						<button class="btn p-0 m-0" onclick="togglePermission({{user.pk}}, 'staff')">
							<i class="bx bxs-check-square text-success fs-1{% if not user.is_staff %} collapse{% endif %}" data-user="{{user.pk}}" data-staff="true"></i>
							<i class="bx bxs-x-square text-danger fs-1{% if user.is_staff %} collapse{% endif %}" data-user="{{user.pk}}" data-staff="false"></i>
						</button>
					</td>
					<td>
						<button class="btn p-0 m-0" onclick="togglePermission({{user.pk}}, 'superuser')">
							<i class="bx bxs-check-square text-success fs-1{% if not user.is_superuser %} collapse{% endif %}" data-user="{{user.pk}}" data-superuser="true"></i>
							<i class="bx bxs-x-square text-danger fs-1{% if user.is_superuser %} collapse{% endif %}" data-user="{{user.pk}}" data-superuser="false"></i>
						</button>
					</td>
					<td>
						<button class="btn p-0 m-0" data-bs-toggle="modal" data-bs-target="[data-modaltype='editPermissions'][data-relateduser='{{user.pk}}']">
							<i class="bx bx-expand text-primary fs-2"></i>
						</button>
					</td>
					<td>
						<button class="btn p-0 m-0" onclick="deleteUser({{user.pk}})">
							<i class="bx bx-trash text-danger fs-1"></i>
						</button>
					</td>
				</tr>
				{% endfor %}
			</tbody>
		</table>
	</div>
</div>
{% endblock %}

{% block extra_javascript %}
<script type="text/javascript">
	const USER_DELETE_URL = '{% url 'control_panel:user-delete' %}';
	const USER_PERMISSIONS_URL = '{% url 'control_panel:user-toggle' %}';
</script>
{% include 'partials/js_datatables.html' %}
{% include 'partials/js_toastr.html' %}
<script src="{% static 'js/users.init.js' %}"></script>
{% endblock %}
